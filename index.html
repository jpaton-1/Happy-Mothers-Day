<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mother's Day AR</title>
    
    <!-- Import A-Frame -->
    <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
    
    <style>
        .ar-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            color: white;
            font-family: Arial, sans-serif;
            z-index: 1000;
            text-align: center;
            padding: 20px;
        }
        
        .ar-buttons {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-top: 20px;
        }
        
        .ar-button {
            background-color: #FF69B4;
            color: white;
            border: none;
            border-radius: 50px;
            padding: 15px 30px;
            font-size: 18px;
            margin: 10px;
            cursor: pointer;
            font-weight: bold;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            width: 240px;
        }
        
        .hearts-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 100;
            overflow: hidden;
        }
        
        .floating-heart {
            position: absolute;
            font-size: 30px;
            animation: float 4s ease-in-out infinite, drift 20s linear infinite;
            opacity: 0.8;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-20px); }
        }
        
        @keyframes drift {
            0% { transform: translateX(0); }
            50% { transform: translateX(20px); }
            100% { transform: translateX(0); }
        }
        
        .debug-panel {
            position: fixed;
            top: 10px;
            left: 10px;
            background-color: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
            z-index: 1000;
            display: none;
        }
        
        .heart {
            color: #ff6b6b;
        }
    </style>
</head>
<body>
    <!-- Start screen overlay -->
    <div id="start-screen" class="ar-overlay">
        <h1>Happy Mother's Day! <span class="heart">‚ù§Ô∏è</span></h1>
        <p>This AR experience lets you place a beautiful flower bouquet in your space.</p>
        <p>Your phone will need to access the camera and motion sensors.</p>
        
        <div class="ar-buttons">
            <button id="start-basic" class="ar-button">Start Experience ‚ù§Ô∏è</button>
        </div>
    </div>
    
    <!-- Hearts container -->
    <div id="hearts-container" class="hearts-container"></div>
    
    <!-- Debug panel -->
    <div id="debug-panel" class="debug-panel">Status: Initializing</div>
    
    <!-- A-Frame Scene -->
    <a-scene embedded loading-screen="enabled: false" vr-mode-ui="enabled: false">
        <!-- Assets -->
        <a-assets>
            <img id="sky" src="https://cdn.glitch.global/605e2a51-d45f-4d87-a285-9410ad350515/color-grid.png?v=1618510917674" crossorigin="anonymous">
        </a-assets>
        
        <!-- Environment -->
        <a-sky color="#ECECEC" opacity="0.1"></a-sky>
        
        <!-- Flower Bouquet -->
        <a-entity id="flowers-container" position="0 0 -1.5" rotation="0 0 0" visible="false">
            <!-- Pot -->
            <a-cylinder position="0 -0.2 0" radius="0.2" height="0.3" color="#E75480" segments-radial="16"></a-cylinder>
            
            <!-- Flowers Group -->
            <a-entity id="flowers-group" position="0 0 0">
                <!-- Stem -->
                <a-cylinder position="0 0.3 0" radius="0.03" height="0.8" color="#228B22"></a-cylinder>
                
                <!-- Flower 1: Pink Rose -->
                <a-entity position="0 0.65 0">
                    <a-sphere color="#FF69B4" radius="0.15"></a-sphere>
                    <a-sphere position="0 0.05 0" color="#FF1493" radius="0.12"></a-sphere>
                </a-entity>
                
                <!-- Flower 2: Yellow Daisy -->
                <a-entity position="0.12 0.55 0.12">
                    <a-sphere color="#FFD700" radius="0.12"></a-sphere>
                    <a-sphere position="0 0.03 0" color="#FF8C00" radius="0.05"></a-sphere>
                </a-entity>
                
                <!-- Flower 3: Purple Tulip -->
                <a-entity position="-0.15 0.6 0.1">
                    <a-sphere color="#9370DB" radius="0.13"></a-sphere>
                    <a-sphere position="0 0.05 0" color="#8A2BE2" radius="0.08"></a-sphere>
                </a-entity>
                
                <!-- Flower 4: Red Rose -->
                <a-entity position="0.08 0.7 -0.1">
                    <a-sphere color="#FF0000" radius="0.14"></a-sphere>
                    <a-sphere position="0 0.05 0" color="#8B0000" radius="0.09"></a-sphere>
                </a-entity>
                
                <!-- Flower 5: White Lily -->
                <a-entity position="-0.12 0.65 -0.15">
                    <a-sphere color="#FFFFFF" radius="0.13"></a-sphere>
                    <a-sphere position="0 0.05 0" color="#FFFF00" radius="0.06"></a-sphere>
                </a-entity>
                
                <!-- Leaves -->
                <a-entity position="0 0.3 0">
                    <a-cone position="0.1 0 0.05" rotation="30 0 -60" radius-bottom="0.1" radius-top="0" height="0.25" color="#006400"></a-cone>
                    <a-cone position="-0.1 0 -0.05" rotation="-30 0 60" radius-bottom="0.1" radius-top="0" height="0.25" color="#006400"></a-cone>
                </a-entity>
                
                <!-- Message Card -->
                <a-entity position="0 -0.1 0.15" rotation="-30 0 0">
                    <a-plane width="0.6" height="0.25" color="#FFF0F5"></a-plane>
                    <a-text value="Happy Mother's Day!" color="#FF1493" align="center" width="0.5" position="0 0.05 0.01"></a-text>
                    <a-text value="I love you, Mom!" color="#FF1493" align="center" width="0.5" position="0 -0.05 0.01" scale="0.8 0.8 0.8"></a-text>
                </a-entity>
            </a-entity>
        </a-entity>
        
        <!-- Camera with look controls for accelerometer -->
        <a-entity id="camera" camera position="0 1.6 0" look-controls="magicWindowTrackingEnabled: true; touchEnabled: true; mouseEnabled: true"></a-entity>
    </a-scene>
    
    <script>
        // Wait for the page to load
        window.addEventListener('load', function() {
            // Get references to elements
            const startScreen = document.getElementById('start-screen');
            const startBasicButton = document.getElementById('start-basic');
            const flowersContainer = document.getElementById('flowers-container');
            const flowersGroup = document.getElementById('flowers-group');
            const heartsContainer = document.getElementById('hearts-container');
            const debugPanel = document.getElementById('debug-panel');
            const camera = document.getElementById('camera');
            
            // Debug Mode - check URL for debug parameter
            const debugMode = window.location.search.includes('debug=true');
            if (debugMode) {
                debugPanel.style.display = 'block';
                updateDebug('Debug mode enabled');
            }
            
            // Start button click handler
            startBasicButton.addEventListener('click', function() {
                startAR();
            });
            
            // Function to start AR experience
            function startAR() {
                updateDebug('Starting AR experience');
                
                // Hide start screen
                startScreen.style.display = 'none';
                
                // Show flowers
                flowersContainer.setAttribute('visible', true);
                
                // Add rotation animation to flowers
                flowersGroup.setAttribute('animation', 'property: rotation; to: 0 360 0; loop: true; dur: 15000; easing: linear');
                
                // Generate floating hearts
                createFloatingHearts();
                
                // Setup accelerometer following
                setupAccelerometerTracking();
                
                updateDebug('AR experience started');
            }
            
            // Function to create floating hearts
            function createFloatingHearts() {
                const heartEmojis = ['‚ù§Ô∏è', 'üíï', 'üíñ', 'üíó', 'üíì', 'üíû'];
                
                // Clear any existing hearts
                heartsContainer.innerHTML = '';
                
                // Create 12 hearts
                for (let i = 0; i < 12; i++) {
                    const heart = document.createElement('div');
                    heart.className = 'floating-heart';
                    heart.textContent = heartEmojis[Math.floor(Math.random() * heartEmojis.length)];
                    
                    // Random position
                    const x = Math.random() * 100;
                    const y = Math.random() * 100;
                    heart.style.left = `${x}%`;
                    heart.style.top = `${y}%`;
                    
                    // Random animation duration
                    heart.style.animationDuration = `${Math.random() * 3 + 3}s, ${Math.random() * 15 + 10}s`;
                    
                    // Random delay
                    heart.style.animationDelay = `${Math.random() * 5}s`;
                    
                    heartsContainer.appendChild(heart);
                }
                
                updateDebug('Created floating hearts');
            }
            
            // Function to setup accelerometer tracking
            function setupAccelerometerTracking() {
                // Request device orientation permission
                if (typeof DeviceOrientationEvent !== 'undefined' && 
                    typeof DeviceOrientationEvent.requestPermission === 'function') {
                    
                    DeviceOrientationEvent.requestPermission()
                        .then(response => {
                            if (response === 'granted') {
                                updateDebug('Device orientation permission granted');
                                enableLookControls();
                            } else {
                                updateDebug('Device orientation permission denied');
                                // Enable backup camera controls
                                enableBackupControls();
                            }
                        })
                        .catch(error => {
                            updateDebug('Error requesting orientation: ' + error);
                            enableBackupControls();
                        });
                } else {
                    // Non-iOS devices or older browsers
                    updateDebug('Device does not require orientation permission');
                    enableLookControls();
                }
            }
            
            // Enable look controls with accelerometer
            function enableLookControls() {
                // Make sure look controls are enabled
                camera.setAttribute('look-controls', 'enabled', true);
                
                // Make flowers follow camera's gaze
                document.addEventListener('mousemove', updateFlowerPosition);
                document.addEventListener('touchmove', updateFlowerPosition);
                
                // Also update flower position periodically based on camera rotation
                setInterval(updateFlowerPositionFromCamera, 100);
                
                updateDebug('Look controls enabled');
            }
            
            // Enable backup controls if accelerometer not available
            function enableBackupControls() {
                updateDebug('Using backup controls');
                
                // Position flowers in front of camera
                flowersContainer.setAttribute('position', '0 0 -1.5');
                
                // Set camera controls to mouse/touch for fallback
                camera.setAttribute('look-controls', 'mouseEnabled: true; touchEnabled: true');
            }
            
            // Update flower position based on camera movement
            function updateFlowerPosition(event) {
                // Keep flowers in view by adjusting position
                flowersContainer.object3D.position.set(0, 0, -1.5);
                
                updateDebug('Flower position updated from user input');
            }
            
            // Update flower position based on camera rotation
            function updateFlowerPositionFromCamera() {
                // Get camera direction
                const cameraRotation = camera.getAttribute('rotation');
                
                // Use camera rotation to adjust flower position slightly
                // This creates a subtle effect of the flowers "following" your gaze
                const offsetX = Math.sin(THREE.MathUtils.degToRad(cameraRotation.y)) * 0.5;
                const offsetY = Math.sin(THREE.MathUtils.degToRad(-cameraRotation.x)) * 0.3;
                
                // Apply the offset to keep flowers in view
                flowersContainer.object3D.position.set(offsetX, offsetY, -1.5);
                
                if (debugMode) {
                    updateDebug(`Camera rot: ${cameraRotation.x.toFixed(1)}, ${cameraRotation.y.toFixed(1)} | Offset: ${offsetX.toFixed(2)}, ${offsetY.toFixed(2)}`);
                }
            }
            
            // Debug message function
            function updateDebug(message) {
                if (debugMode) {
                    debugPanel.textContent = message;
                    console.log('[Debug] ' + message);
                }
            }
        });
    </script>
</body>
</html>