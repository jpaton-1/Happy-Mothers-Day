<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mother's Day AR - Tap to Place</title>
    
    <!-- A-Frame -->
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <!-- AR.js -->
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar-nft.js"></script>
    
    <style>
        .arjs-loader {
            position: fixed;
            z-index: 999;
            overflow: show;
            margin: auto;
            top: 0;
            left: 0;
            bottom: 0;
            right: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .arjs-loader div {
            text-align: center;
            color: white;
            max-width: 80%;
            font-family: Arial, Helvetica, sans-serif;
            padding: 20px;
        }
        
        .tap-button {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 15;
            background: #FF69B4;
            color: white;
            border: none;
            border-radius: 50px;
            width: 200px;
            height: 60px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }
        
        .reset-button {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 15;
            background: #f44336;
            color: white;
            border: none;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            font-size: 24px;
            cursor: pointer;
            display: none;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
        }
        
        /* Mother's day specific styling */
        .heart {
            color: #ff6b6b;
        }
        
        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
            100% { transform: translateY(0px); }
        }
        
        .floating-heart {
            position: fixed;
            font-size: 24px;
            color: #ff6b6b;
            z-index: 5;
            pointer-events: none;
            opacity: 0.8;
            animation: float 3s ease-in-out infinite;
        }
        
        .debug-info {
            position: fixed;
            top: 10px;
            left: 10px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 10px;
            font-family: monospace;
            font-size: 12px;
            z-index: 100;
            display: none;
        }
    </style>
</head>
<body style="margin: 0; overflow: hidden;">
    <div class="arjs-loader">
        <div>
            <h1>Happy Mother's Day! <span class="heart">❤️</span></h1>
            <p>Loading AR experience... Please allow camera access when prompted.</p>
            <p>You'll be able to place flowers in your space!</p>
        </div>
    </div>
    
    <!-- Simpler tap UI -->
    <button id="tap-button" class="tap-button">Tap to Place Flowers ❤️</button>
    <button id="reset-button" class="reset-button">↺</button>
    
    <!-- Debug info -->
    <div id="debug-info" class="debug-info"></div>
    
    <!-- A-Frame scene -->
    <a-scene 
        embedded
        vr-mode-ui="enabled: false"
        device-orientation-permission-ui="enabled: false"
        renderer="logarithmicDepthBuffer: true; precision: medium;"
        arjs="trackingMethod: best; sourceType: webcam; debugUIEnabled: false;">
        
        <!-- Bouquet container (hidden until placed) -->
        <a-entity id="bouquet-container" visible="false" position="0 0 -2">
            <!-- Base - Flower pot -->
            <a-cylinder 
                position="0 -0.15 0" 
                radius="0.15" 
                height="0.3" 
                color="#FF69B4"
                segments-radial="12">
            </a-cylinder>
            
            <!-- Main flower bouquet -->
            <a-entity position="0 0 0">
                <!-- Base stem -->
                <a-cylinder 
                    position="0 0.2 0" 
                    radius="0.05" 
                    height="0.5" 
                    color="#228B22">
                </a-cylinder>
                
                <!-- Flower 1 - Pink -->
                <a-entity position="0.15 0.4 0.15">
                    <a-sphere color="#FF69B4" radius="0.15"></a-sphere>
                    <a-torus-knot position="0 0 0" radius="0.12" radius-tubular="0.015" segments-tubular="32" color="#FFB6C1"></a-torus-knot>
                </a-entity>
                
                <!-- Flower 2 - Red -->
                <a-entity position="-0.15 0.45 -0.15">
                    <a-sphere color="#FF0000" radius="0.15"></a-sphere>
                    <a-torus-knot position="0 0 0" radius="0.12" radius-tubular="0.015" segments-tubular="32" color="#FF6347"></a-torus-knot>
                </a-entity>
                
                <!-- Flower 3 - Yellow -->
                <a-entity position="0 0.5 0">
                    <a-sphere color="#FFD700" radius="0.18"></a-sphere>
                    <a-torus-knot position="0 0 0" radius="0.15" radius-tubular="0.018" segments-tubular="32" color="#FFFF00"></a-torus-knot>
                </a-entity>
                
                <!-- Flower 4 - Blue -->
                <a-entity position="0.2 0.35 -0.1">
                    <a-sphere color="#1E90FF" radius="0.12"></a-sphere>
                    <a-torus-knot position="0 0 0" radius="0.09" radius-tubular="0.015" segments-tubular="32" color="#87CEFA"></a-torus-knot>
                </a-entity>
                
                <!-- Flower 5 - Purple -->
                <a-entity position="-0.2 0.4 0.1">
                    <a-sphere color="#9400D3" radius="0.14"></a-sphere>
                    <a-torus-knot position="0 0 0" radius="0.11" radius-tubular="0.015" segments-tubular="32" color="#BA55D3"></a-torus-knot>
                </a-entity>
                
                <!-- Leaves -->
                <a-entity position="0 0.2 0">
                    <a-cone position="0.15 0 0" rotation="0 0 -45" radius-bottom="0.15" radius-top="0" height="0.3" color="#006400"></a-cone>
                    <a-cone position="-0.15 0 0" rotation="0 0 45" radius-bottom="0.15" radius-top="0" height="0.3" color="#006400"></a-cone>
                </a-entity>
                
                <!-- Mother's Day message -->
                <a-text
                    value="Happy Mother's Day!"
                    color="#FF1493"
                    align="center"
                    width="1"
                    position="0 -0.3 0"
                    rotation="-90 0 0">
                </a-text>
                
                <!-- I love you message -->
                <a-text
                    value="I love you, Mom!"
                    color="#FF1493"
                    align="center"
                    width="0.8"
                    position="0 -0.35 0"
                    rotation="-90 0 0"
                    scale="0.7 0.7 0.7">
                </a-text>
            </a-entity>
        </a-entity>
        
        <!-- Camera -->
        <a-entity camera position="0 1.6 0" look-controls="enabled: false"></a-entity>
    </a-scene>
    
    <script>
        // Mobile fix - wait for scene to load
        window.addEventListener('load', function() {
            // Get references to elements
            const scene = document.querySelector('a-scene');
            const loader = document.querySelector('.arjs-loader');
            const tapButton = document.getElementById('tap-button');
            const resetButton = document.getElementById('reset-button');
            const bouquetContainer = document.getElementById('bouquet-container');
            const debugInfo = document.getElementById('debug-info');
            
            // Hide loader after scene loads or timeout
            if (scene) {
                scene.addEventListener('loaded', function() {
                    if (loader) {
                        loader.style.display = 'none';
                    }
                });
            }
            
            // Fallback - hide loader after timeout
            setTimeout(() => {
                if (loader) loader.style.display = 'none';
            }, 6000);
            
            // Handle tap-to-place with simple button
            tapButton.addEventListener('click', function(event) {
                event.preventDefault();
                event.stopPropagation();
                
                // Show flowers with animation
                bouquetContainer.setAttribute('visible', true);
                bouquetContainer.setAttribute('animation', 'property: rotation; to: 0 360 0; loop: true; dur: 10000; easing: linear');
                
                // Hide tap button
                tapButton.style.display = 'none';
                
                // Show reset button
                resetButton.style.display = 'flex';
                
                // Create floating hearts
                createFloatingHearts();
                
                // For debugging
                if (debugInfo) {
                    debugInfo.textContent = "Flowers placed successfully";
                }
                
                return false;
            });
            
            // Handle reset button
            resetButton.addEventListener('click', function(event) {
                event.preventDefault();
                event.stopPropagation();
                
                // Hide flowers and remove animation
                bouquetContainer.setAttribute('visible', false);
                bouquetContainer.removeAttribute('animation');
                
                // Remove floating hearts
                document.querySelectorAll('.floating-heart').forEach(heart => {
                    heart.parentNode.removeChild(heart);
                });
                
                // Show tap button
                tapButton.style.display = 'flex';
                
                // Hide reset button
                resetButton.style.display = 'none';
                
                // For debugging
                if (debugInfo) {
                    debugInfo.textContent = "Reset completed";
                }
                
                return false;
            });
            
            // Debug mode - enable by adding ?debug=true to the URL
            if (window.location.search.includes('debug=true')) {
                debugInfo.style.display = 'block';
            }
            
            // Create floating hearts function
            function createFloatingHearts() {
                const heartSymbols = ['❤️', '💖', '💕', '💗', '💓'];
                for (let i = 0; i < 8; i++) {
                    const heart = document.createElement('div');
                    heart.className = 'floating-heart';
                    heart.textContent = heartSymbols[Math.floor(Math.random() * heartSymbols.length)];
                    
                    // Random position
                    const left = Math.random() * 80 + 10; // 10% to 90% of screen width
                    const top = Math.random() * 80 + 10;  // 10% to 90% of screen height
                    
                    heart.style.left = `${left}%`;
                    heart.style.top = `${top}%`;
                    
                    // Random animation duration
                    heart.style.animationDuration = `${Math.random() * 2 + 2}s`;
                    
                    document.body.appendChild(heart);
                }
            }
            
            // Touch events for mobile
            if ('ontouchstart' in window) {
                debugInfo.textContent = "Touch device detected";
                
                // Ensure full-page touch works
                document.addEventListener('touchstart', function(e) {
                    // Just capture touch events - don't do anything here
                }, { passive: false });
            }
        });
    </script>
</body>
</html>